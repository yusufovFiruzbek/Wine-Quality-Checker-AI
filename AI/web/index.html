<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Quality AI - Advanced Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.26.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-height: 450px;
        }

        .large-chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-height: 500px;
            grid-column: 1 / -1;
        }

        .card h2, .chart-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .chart-card h3 {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }

        .large-chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .plotly-container {
            height: 400px;
            width: 100%;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        input {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .alcohol-input {
            border-color: #667eea !important;
            background-color: #f8f9ff;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .results-container {
            text-align: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .regression-result {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .classification-result {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .result-score {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .result-details {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .quality-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .good-quality {
            background: #28a745;
            color: white;
        }

        .average-quality {
            background: #ffc107;
            color: #333;
        }

        .placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .insights {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .insights h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .insights ul {
            list-style: none;
            padding: 0;
        }

        .insights li {
            padding: 5px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .insights li:before {
            content: "‚Ä¢";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-top: 40px;
        }

        .chart-description {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            line-height: 1.4;
        }

        .real-time-panel {
            background: #f8f9ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .real-time-panel h4 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }

        .impact-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .impact-indicator:last-child {
            border-bottom: none;
        }

        .impact-value {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 0.9rem;
        }

        .positive-impact {
            background: #28a745;
        }

        .negative-impact {
            background: #dc3545;
        }

        .neutral-impact {
            background: #6c757d;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-card {
                min-height: 400px;
            }

            .chart-container {
                height: 300px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üç∑ Wine Quality AI - Advanced Analytics</h1>
            <p>Comprehensive machine learning dashboard with interactive visualizations, real-time feature impact analysis, and 3D correlation mapping based on UCI Red Wine Quality dataset research.</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">1,599</div>
                <div class="stat-label">Wine Samples</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">78.1%</div>
                <div class="stat-label">Classification Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0.64</div>
                <div class="stat-label">Regression RMSE</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">11</div>
                <div class="stat-label">Features</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5.64</div>
                <div class="stat-label">Mean Quality</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3-8</div>
                <div class="stat-label">Quality Range</div>
            </div>
        </div>

        <!-- Advanced Charts Dashboard -->
        <div class="dashboard-grid">
            <!-- Quality Distribution Chart -->
            <div class="chart-card">
                <h3>üìä Quality Score Distribution</h3>
                <div class="chart-container">
                    <canvas id="qualityDistributionChart"></canvas>
                </div>
                <div class="chart-description">
                    Distribution of wine quality scores in the dataset. Most wines score 5-6, with few excellent (8) or poor (3) wines.
                </div>
            </div>

            <!-- Model Performance Comparison -->
            <div class="chart-card">
                <h3>üèÜ Model Performance Comparison</h3>
                <div class="chart-container">
                    <canvas id="modelPerformanceChart"></canvas>
                </div>
                <div class="chart-description">
                    Comparison of different ML algorithms. Logistic Regression shows best classification performance.
                </div>
            </div>

            <!-- Feature Importance Chart -->
            <div class="chart-card">
                <h3>üìà Feature Importance Analysis</h3>
                <div class="chart-container">
                    <canvas id="featureImportanceChart"></canvas>
                </div>
                <div class="chart-description">
                    Features ranked by predictive power. Alcohol content dominates wine quality prediction.
                </div>
            </div>

            <!-- Correlation Chart -->
            <div class="chart-card">
                <h3>üîó Feature Correlation Matrix</h3>
                <div class="chart-container">
                    <canvas id="correlationChart"></canvas>
                </div>
                <div class="chart-description">
                    Positive and negative correlations with wine quality. Green = positive impact, Red = negative impact.
                </div>
            </div>

            <!-- 3D Correlation Heatmap -->
            <div class="large-chart-card">
                <h3>üåê 3D Correlation Heatmap</h3>
                <div id="correlation3D" class="plotly-container"></div>
                <div class="chart-description">
                    Interactive 3D visualization of feature correlations. Hover and rotate to explore relationships between all wine characteristics.
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Panel -->
            <div class="card">
                <h2>‚ö° Wine Characteristics</h2>
                <p style="color: #666; margin-bottom: 20px;">Enter wine properties to see real-time AI predictions and feature impact analysis</p>
                
                <form id="wineForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fixedAcidity">Fixed Acidity</label>
                            <input type="number" id="fixedAcidity" step="0.1" value="7.4" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="volatileAcidity">Volatile Acidity</label>
                            <input type="number" id="volatileAcidity" step="0.01" value="0.7" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="citricAcid">Citric Acid</label>
                            <input type="number" id="citricAcid" step="0.01" value="0.0" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="residualSugar">Residual Sugar</label>
                            <input type="number" id="residualSugar" step="0.1" value="1.9" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="chlorides">Chlorides</label>
                            <input type="number" id="chlorides" step="0.001" value="0.076" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="freeSulfurDioxide">Free SO‚ÇÇ</label>
                            <input type="number" id="freeSulfurDioxide" value="11" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="totalSulfurDioxide">Total SO‚ÇÇ</label>
                            <input type="number" id="totalSulfurDioxide" value="34" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="density">Density</label>
                            <input type="number" id="density" step="0.0001" value="0.9978" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="pH">pH</label>
                            <input type="number" id="pH" step="0.01" value="3.51" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group">
                            <label for="sulphates">Sulphates</label>
                            <input type="number" id="sulphates" step="0.01" value="0.56" oninput="updateRealTimeImpact()">
                        </div>
                        <div class="form-group full-width">
                            <label for="alcohol">Alcohol % (Most Important Feature)</label>
                            <input type="number" id="alcohol" class="alcohol-input" step="0.1" value="9.4" oninput="updateRealTimeImpact()">
                        </div>
                    </div>

                    <!-- Real-time Feature Impact Panel -->
                    <div class="real-time-panel">
                        <h4>üîÑ Real-time Feature Impact</h4>
                        <div id="realTimeImpact">
                            <div class="impact-indicator">
                                <span>Alcohol Impact:</span>
                                <span class="impact-value neutral-impact" id="alcoholImpact">Neutral</span>
                            </div>
                            <div class="impact-indicator">
                                <span>Sulphates Impact:</span>
                                <span class="impact-value neutral-impact" id="sulphatesImpact">Neutral</span>
                            </div>
                            <div class="impact-indicator">
                                <span>Volatile Acidity Impact:</span>
                                <span class="impact-value neutral-impact" id="volatileAcidityImpact">Neutral</span>
                            </div>
                            <div class="impact-indicator">
                                <span>Overall Quality Trend:</span>
                                <span class="impact-value neutral-impact" id="overallImpact">Baseline</span>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn-primary" id="predictBtn">Predict Quality</button>
                        <button type="button" class="btn-secondary" onclick="resetForm()">Reset</button>
                    </div>
                </form>
            </div>

            <!-- Results Panel -->
            <div class="card">
                <h2>üß† AI Predictions</h2>
                <p style="color: #666; margin-bottom: 20px;">Results from regression and classification models</p>
                
                <div id="resultsContainer" class="results-container">
                    <div class="placeholder">
                        <div class="placeholder-icon">üç∑</div>
                        <p>Enter wine characteristics and click "Predict Quality" to see AI predictions</p>
                    </div>
                </div>

                <div class="insights">
                    <h4>Key Research Findings:</h4>
                    <ul>
                        <li>Alcohol content shows strongest correlation (0.48) with quality</li>
                        <li>Sulphates and citric acid positively impact quality</li>
                        <li>Volatile acidity strongly reduces quality (-0.39 correlation)</li>
                        <li>Quality distribution is right-skewed (mean: 5.64)</li>
                        <li>Only 13.6% of wines achieve "good quality" (‚â•7)</li>
                        <li>SMOTE balancing improved classification performance</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Based on UCI Red Wine Quality Dataset | Advanced Analytics by Firuzbek Yusufov</p>
            <p>Models: Linear Regression (RMSE: 0.64), Logistic Regression (Accuracy: 78.1%), Feature Selection with SMOTE</p>
        </div>
    </div>

    <script>
        let currentPrediction = null;
        let charts = {};
        
        // Dataset statistics based on your research
        const datasetStats = {
            qualityDistribution: [0, 0, 0, 10, 53, 681, 638, 199, 18, 0, 0], // Quality 0-10
            meanValues: {
                fixedAcidity: 8.32,
                volatileAcidity: 0.53,
                citricAcid: 0.27,
                residualSugar: 2.54,
                chlorides: 0.087,
                freeSulfurDioxide: 15.87,
                totalSulfurDioxide: 46.47,
                density: 0.9967,
                pH: 3.31,
                sulphates: 0.66,
                alcohol: 10.42
            },
            correlations: {
                alcohol: 0.48,
                sulphates: 0.31,
                citricAcid: 0.23,
                fixedAcidity: 0.12,
                residualSugar: 0.01,
                freeSulfurDioxide: -0.05,
                pH: -0.06,
                chlorides: -0.13,
                density: -0.17,
                totalSulfurDioxide: -0.19,
                volatileAcidity: -0.39
            }
        };

        // Initialize all charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeAllCharts();
            updateRealTimeImpact();
        });

        // Initialize all charts
        function initializeAllCharts() {
            initializeQualityDistribution();
            initializeModelPerformance();
            initializeFeatureImportance();
            initializeCorrelationChart();
            initialize3DCorrelation();
        }

        // Quality Distribution Chart
        function initializeQualityDistribution() {
            const ctx = document.getElementById('qualityDistributionChart').getContext('2d');
            
            charts.qualityDistribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['3', '4', '5', '6', '7', '8'],
                    datasets: [{
                        label: 'Number of Wines',
                        data: [10, 53, 681, 638, 199, 18],
                        backgroundColor: [
                            '#ff6b6b', '#ffa726', '#ffee58', 
                            '#66bb6a', '#42a5f5', '#ab47bc'
                        ],
                        borderColor: '#fff',
                        borderWidth: 2,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = 1599;
                                    const percentage = ((context.parsed.y / total) * 100).toFixed(1);
                                    return `${context.parsed.y} wines (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Number of Wines' }
                        },
                        x: {
                            title: { display: true, text: 'Quality Score' }
                        }
                    },
                    animation: { duration: 2000, easing: 'easeInOutQuart' }
                }
            });
        }

        // Model Performance Comparison Chart
        function initializeModelPerformance() {
            const ctx = document.getElementById('modelPerformanceChart').getContext('2d');
            
            charts.modelPerformance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Accuracy', 'Precision', 'Recall', 'F1-Score', 'Speed', 'Interpretability'],
                    datasets: [{
                        label: 'Logistic Regression',
                        data: [78.1, 82, 67, 79, 95, 90],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: '#667eea',
                        borderWidth: 3,
                        pointBackgroundColor: '#667eea',
                        pointRadius: 6
                    }, {
                        label: 'Linear Regression (RMSE)',
                        data: [64, 70, 65, 67, 98, 95],
                        backgroundColor: 'rgba(118, 75, 162, 0.2)',
                        borderColor: '#764ba2',
                        borderWidth: 3,
                        pointBackgroundColor: '#764ba2',
                        pointRadius: 6
                    }, {
                        label: 'Random Forest (Estimated)',
                        data: [82, 85, 78, 81, 70, 60],
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        borderColor: '#28a745',
                        borderWidth: 3,
                        pointBackgroundColor: '#28a745',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { stepSize: 20 }
                        }
                    },
                    animation: { duration: 2000, easing: 'easeInOutQuart' }
                }
            });
        }

        // Feature Importance Chart
        function initializeFeatureImportance() {
            const ctx = document.getElementById('featureImportanceChart').getContext('2d');
            
            const features = Object.keys(datasetStats.correlations);
            const correlations = Object.values(datasetStats.correlations);
            
            charts.featureImportance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: features.map(f => f.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())),
                    datasets: [{
                        label: 'Correlation with Quality',
                        data: correlations,
                        backgroundColor: correlations.map(val => val > 0 ? '#28a745' : '#dc3545'),
                        borderColor: '#fff',
                        borderWidth: 2,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Correlation: ${context.parsed.y.toFixed(3)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Correlation Coefficient' }
                        },
                        x: {
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    },
                    animation: { duration: 2000, easing: 'easeInOutQuart' }
                }
            });
        }

        // Correlation Scatter Chart
        function initializeCorrelationChart() {
            const ctx = document.getElementById('correlationChart').getContext('2d');
            
            const positiveCorr = Object.entries(datasetStats.correlations)
                .filter(([key, val]) => val > 0)
                .map(([key, val]) => ({x: key, y: val}));
                
            const negativeCorr = Object.entries(datasetStats.correlations)
                .filter(([key, val]) => val < 0)
                .map(([key, val]) => ({x: key, y: val}));

            charts.correlation = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Positive Correlation',
                        data: positiveCorr,
                        backgroundColor: '#28a745',
                        borderColor: '#28a745',
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }, {
                        label: 'Negative Correlation',
                        data: negativeCorr,
                        backgroundColor: '#dc3545',
                        borderColor: '#dc3545',
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw.x}: ${context.raw.y.toFixed(3)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: -0.5,
                            max: 0.6,
                            title: { display: true, text: 'Correlation Coefficient' }
                        },
                        x: {
                            type: 'category',
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    },
                    animation: { duration: 2000, easing: 'easeInOutQuart' }
                }
            });
        }

        // 3D Correlation Heatmap using Plotly
        function initialize3DCorrelation() {
            const features = Object.keys(datasetStats.correlations);
            const correlationMatrix = [];
            
            // Create correlation matrix (simplified for demo)
            for (let i = 0; i < features.length; i++) {
                correlationMatrix[i] = [];
                for (let j = 0; j < features.length; j++) {
                    if (i === j) {
                        correlationMatrix[i][j] = 1.0;
                    } else {
                        // Simulate correlation between features
                        correlationMatrix[i][j] = Math.random() * 0.6 - 0.3;
                    }
                }
            }

            const data = [{
                z: correlationMatrix,
                x: features,
                y: features,
                type: 'surface',
                colorscale: [
                    [0, '#dc3545'],
                    [0.5, '#ffffff'],
                    [1, '#28a745']
                ],
                showscale: true,
                colorbar: {
                    title: 'Correlation',
                    titleside: 'right'
                }
            }];

            const layout = {
                title: '',
                scene: {
                    xaxis: { title: 'Features' },
                    yaxis: { title: 'Features' },
                    zaxis: { title: 'Correlation' },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 }
                    }
                },
                margin: { l: 0, r: 0, b: 0, t: 0 },
                autosize: true
            };

            Plotly.newPlot('correlation3D', data, layout, {responsive: true});
        }

        // Real-time feature impact analysis
        function updateRealTimeImpact() {
            const features = {
                alcohol: parseFloat(document.getElementById('alcohol').value) || 0,
                sulphates: parseFloat(document.getElementById('sulphates').value) || 0,
                volatileAcidity: parseFloat(document.getElementById('volatileAcidity').value) || 0
            };

            // Calculate impact based on deviation from mean
            const alcoholImpact = (features.alcohol - datasetStats.meanValues.alcohol) * datasetStats.correlations.alcohol;
            const sulphatesImpact = (features.sulphates - datasetStats.meanValues.sulphates) * datasetStats.correlations.sulphates;
            const volatileAcidityImpact = (features.volatileAcidity - datasetStats.meanValues.volatileAcidity) * datasetStats.correlations.volatileAcidity;
            
            const overallImpact = alcoholImpact + sulphatesImpact + volatileAcidityImpact;

            // Update impact indicators
            updateImpactIndicator('alcoholImpact', alcoholImpact);
            updateImpactIndicator('sulphatesImpact', sulphatesImpact);
            updateImpactIndicator('volatileAcidityImpact', volatileAcidityImpact);
            updateImpactIndicator('overallImpact', overallImpact);
        }

        function updateImpactIndicator(elementId, impact) {
            const element = document.getElementById(elementId);
            element.className = 'impact-value';
            
            if (impact > 0.1) {
                element.classList.add('positive-impact');
                element.textContent = `+${impact.toFixed(2)}`;
            } else if (impact < -0.1) {
                element.classList.add('negative-impact');
                element.textContent = impact.toFixed(2);
            } else {
                element.classList.add('neutral-impact');
                element.textContent = 'Neutral';
            }
        }

        // Form submission handler
        document.getElementById('wineForm').addEventListener('submit', function(e) {
            e.preventDefault();
            predictWineQuality();
        });

        // Predict wine quality function
        function predictWineQuality() {
            const predictBtn = document.getElementById('predictBtn');
            predictBtn.disabled = true;
            predictBtn.textContent = 'Predicting...';

            // Get form values
            const features = {
                fixedAcidity: parseFloat(document.getElementById('fixedAcidity').value) || 0,
                volatileAcidity: parseFloat(document.getElementById('volatileAcidity').value) || 0,
                citricAcid: parseFloat(document.getElementById('citricAcid').value) || 0,
                residualSugar: parseFloat(document.getElementById('residualSugar').value) || 0,
                chlorides: parseFloat(document.getElementById('chlorides').value) || 0,
                freeSulfurDioxide: parseFloat(document.getElementById('freeSulfurDioxide').value) || 0,
                totalSulfurDioxide: parseFloat(document.getElementById('totalSulfurDioxide').value) || 0,
                density: parseFloat(document.getElementById('density').value) || 0,
                pH: parseFloat(document.getElementById('pH').value) || 0,
                sulphates: parseFloat(document.getElementById('sulphates').value) || 0,
                alcohol: parseFloat(document.getElementById('alcohol').value) || 0
            };

            // Simulate API call delay
            setTimeout(() => {
                // Enhanced prediction logic based on your research
                let qualityScore = 5.64; // Start with dataset mean
                
                // Apply correlations from your research
                Object.keys(features).forEach(feature => {
                    if (datasetStats.correlations[feature]) {
                        const deviation = features[feature] - datasetStats.meanValues[feature];
                        qualityScore += deviation * datasetStats.correlations[feature];
                    }
                });

                // Normalize to 0-10 range
                qualityScore = Math.max(0, Math.min(10, qualityScore));

                const isGoodQuality = qualityScore >= 6;
                const confidence = Math.min(95, 60 + Math.abs(features.alcohol - 10.42) * 5);

                currentPrediction = {
                    qualityScore: Math.round(qualityScore * 10) / 10,
                    isGoodQuality: isGoodQuality,
                    confidence: Math.round(confidence)
                };

                displayResults();
                updateChartsWithPrediction(features);
                
                predictBtn.disabled = false;
                predictBtn.textContent = 'Predict Quality';
            }, 1000);
        }

        // Update charts with current prediction
        function updateChartsWithPrediction(features) {
            // Update quality distribution with current prediction
            const qualityIndex = Math.round(currentPrediction.qualityScore) - 3;
            if (qualityIndex >= 0 && qualityIndex < 6) {
                // Highlight the predicted quality bar
                const newColors = ['#ff6b6b', '#ffa726', '#ffee58', '#66bb6a', '#42a5f5', '#ab47bc'];
                newColors[qualityIndex] = '#ffc107'; // Highlight predicted quality
                charts.qualityDistribution.data.datasets[0].backgroundColor = newColors;
                charts.qualityDistribution.update('none');
            }

            // Update feature importance chart
            const alcoholIndex = 0; // Alcohol is first in the correlation list
            const newFeatureColors = Object.values(datasetStats.correlations).map(val => val > 0 ? '#28a745' : '#dc3545');
            newFeatureColors[alcoholIndex] = '#ffc107'; // Highlight alcohol
            charts.featureImportance.data.datasets[0].backgroundColor = newFeatureColors;
            charts.featureImportance.update('none');
        }

        // Display prediction results
        function displayResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            
            resultsContainer.innerHTML = `
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('regression')">Regression</button>
                    <button class="tab" onclick="switchTab('classification')">Classification</button>
                </div>

                <div id="regression-content" class="tab-content active regression-result">
                    <div class="result-score">${currentPrediction.qualityScore}/10</div>
                    <div class="result-label">Predicted Quality Score</div>
                    <div class="result-details">
                        Model: Multiple Linear Regression<br>
                        RMSE: 0.64 | R¬≤: 0.36 | MAE: 0.51<br>
                        MAPE: 8.7%
                    </div>
                </div>

                <div id="classification-content" class="tab-content classification-result">
                    <div class="quality-badge ${currentPrediction.isGoodQuality ? 'good-quality' : 'average-quality'}">
                        ${currentPrediction.isGoodQuality ? 'Good Quality (‚â•6)' : 'Average Quality (<6)'}
                    </div>
                    <div class="result-label">Confidence: ${currentPrediction.confidence}%</div>
                    <div class="result-details">
                        Model: Logistic Regression with SMOTE<br>
                        Accuracy: 78.1% | Precision: 0.82 | Recall: 0.67<br>
                        F1-Score: 0.79
                    </div>
                </div>
            `;
        }

        // Switch between tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
        }

        // Reset form to default values
        function resetForm() {
            // Reset all input values to defaults
            document.getElementById('fixedAcidity').value = '7.4';
            document.getElementById('volatileAcidity').value = '0.7';
            document.getElementById('citricAcid').value = '0.0';
            document.getElementById('residualSugar').value = '1.9';
            document.getElementById('chlorides').value = '0.076';
            document.getElementById('freeSulfurDioxide').value = '11';
            document.getElementById('totalSulfurDioxide').value = '34';
            document.getElementById('density').value = '0.9978';
            document.getElementById('pH').value = '3.51';
            document.getElementById('sulphates').value = '0.56';
            document.getElementById('alcohol').value = '9.4';
            
            // Reset results
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div class="placeholder">
                    <div class="placeholder-icon">üç∑</div>
                    <p>Enter wine characteristics and click "Predict Quality" to see AI predictions</p>
                </div>
            `;
            
            // Reset charts to original colors
            if (charts.qualityDistribution) {
                charts.qualityDistribution.data.datasets[0].backgroundColor = [
                    '#ff6b6b', '#ffa726', '#ffee58', '#66bb6a', '#42a5f5', '#ab47bc'
                ];
                charts.qualityDistribution.update('none');
            }

            if (charts.featureImportance) {
                const originalColors = Object.values(datasetStats.correlations).map(val => val > 0 ? '#28a745' : '#dc3545');
                charts.featureImportance.data.datasets[0].backgroundColor = originalColors;
                charts.featureImportance.update('none');
            }
            
            // Reset real-time impact
            updateRealTimeImpact();
            currentPrediction = null;
        }
    </script>
</body>
</html>